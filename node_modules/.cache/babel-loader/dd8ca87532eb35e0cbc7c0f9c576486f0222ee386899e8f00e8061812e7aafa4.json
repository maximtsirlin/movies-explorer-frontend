{"ast":null,"code":"var _jsxFileName = \"/Users/macbook/Yandex.Disk.localized/dev/diploma/movies-explorer-api/src/utils/CurrentUserContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport MainApi from '../utils/MainApi';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CurrentUserContext = /*#__PURE__*/createContext();\nexport function useCurrentUser() {\n  _s();\n  return useContext(CurrentUserContext);\n}\n_s(useCurrentUser, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport function CurrentUserProvider({\n  children\n}) {\n  _s2();\n  const [error, setError] = useState('');\n  const [token, setToken] = useState(localStorage.getItem('jwt') || null);\n  const [currentUser, setCurrentUser] = useState(null);\n  const navigate = useNavigate();\n  const login = async (email, password) => {\n    try {\n      const resp = await MainApi.login(email, password);\n      if (!resp.token) {\n        throw new Error('No token received');\n      }\n      localStorage.setItem('jwt', resp.token); // Сохраняем токен в localStorage\n      setToken(resp.token);\n      console.log('token', resp.token);\n      navigate('/movies/all');\n    } catch (e) {\n      console.error(e);\n      setError(e.message);\n    }\n  };\n  const logout = () => {\n    localStorage.removeItem('jwt');\n    setToken(null);\n    setCurrentUser(null);\n    navigate('/');\n  };\n  useEffect(() => {\n    if (!token) {\n      return;\n    }\n    console.log('token', token);\n    MainApi.getInfo(token).then(userInfo => {\n      console.log('userInfo', userInfo);\n      if (userInfo) {\n        setCurrentUser(userInfo);\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  }, [token]);\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: {\n      token,\n      login,\n      logout,\n      currentUser,\n      error,\n      token\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 9\n  }, this);\n}\n_s2(CurrentUserProvider, \"svsSa1bWH9TKfQqvlHE05a/UKvw=\", false, function () {\n  return [useNavigate];\n});\n_c = CurrentUserProvider;\nvar _c;\n$RefreshReg$(_c, \"CurrentUserProvider\");","map":{"version":3,"names":["createContext","useContext","useState","useEffect","useNavigate","MainApi","jsxDEV","_jsxDEV","CurrentUserContext","useCurrentUser","_s","CurrentUserProvider","children","_s2","error","setError","token","setToken","localStorage","getItem","currentUser","setCurrentUser","navigate","login","email","password","resp","Error","setItem","console","log","e","message","logout","removeItem","getInfo","then","userInfo","catch","err","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/macbook/Yandex.Disk.localized/dev/diploma/movies-explorer-api/src/utils/CurrentUserContext.js"],"sourcesContent":["import { createContext, useContext, useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport MainApi from '../utils/MainApi';\n\nconst CurrentUserContext = createContext();\n\nexport function useCurrentUser() {\n    return useContext(CurrentUserContext);\n}\n\nexport function CurrentUserProvider({ children }) {\n    const [error, setError] = useState('');\n    const [token, setToken] = useState(localStorage.getItem('jwt') || null);\n    const [currentUser, setCurrentUser] = useState(null);\n    const navigate = useNavigate();\n\n    const login = async (email, password) => {\n        try {\n            const resp = await MainApi.login(email, password);\n            if (!resp.token) {\n                throw new Error('No token received');\n            }\n            localStorage.setItem('jwt', resp.token); // Сохраняем токен в localStorage\n            setToken(resp.token);\n            console.log('token', resp.token);\n            navigate('/movies/all');\n        } catch (e) {\n            console.error(e);\n            setError(e.message);\n        }\n    };\n\n    const logout = () => {\n        localStorage.removeItem('jwt');\n        setToken(null);\n        setCurrentUser(null);\n        navigate('/');\n    };\n\n    useEffect(() => {\n        if (!token) {\n            return;\n        }\n        console.log('token', token);\n        MainApi.getInfo(token)\n            .then((userInfo) => {\n                console.log('userInfo', userInfo)\n                if (userInfo) {\n                    setCurrentUser(userInfo);\n                }\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n    }, [token]);\n\n    return (\n        <CurrentUserContext.Provider value={{ token, login, logout, currentUser, error, token }}>\n            {children}\n        </CurrentUserContext.Provider>\n    );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}