{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useNavigate } from \"react-router-dom\";\nimport { useEffect, useState } from \"react\";\nimport MainApi from \"../utils/MainApi\";\nexport default function useLogin() {\n  _s();\n  const [error, setError] = useState('');\n  const [token, setToken] = useState(null);\n  const [currentUser, setCurrentUser] = useState(null);\n  const navigate = useNavigate();\n  const login = async (email, password) => {\n    try {\n      const resp = await MainApi.login(email, password);\n      if (!resp.token) {\n        throw new Error('No token received');\n      }\n      localStorage.jwt = resp.token;\n      setToken(resp.token);\n      console.log('token', resp.token);\n    } catch (e) {\n      console.error(e);\n      setError(e.message);\n    }\n  };\n  useEffect(() => {\n    if (!localStorage.jwt) {\n      return;\n    }\n    MainApi.getInfo(localStorage.jwt).then(userInfo => {\n      if (userInfo) {\n        setCurrentUser(userInfo.data);\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n    setToken(localStorage.jwt);\n    navigate(\"/movies/all\");\n  }, []);\n  return {\n    currentUser,\n    login,\n    error,\n    loggedIn: !!token\n  };\n}\n_s(useLogin, \"RgcWnTPEh5PIXZrv4Qs//xJOoKk=\", false, function () {\n  return [useNavigate];\n});","map":{"version":3,"names":["useNavigate","useEffect","useState","MainApi","useLogin","_s","error","setError","token","setToken","currentUser","setCurrentUser","navigate","login","email","password","resp","Error","localStorage","jwt","console","log","e","message","getInfo","then","userInfo","data","catch","err","loggedIn"],"sources":["/Users/macbook/Yandex.Disk.localized/dev/diploma/movies-explorer-api/src/hooks/useLogin.js"],"sourcesContent":["import { useNavigate } from \"react-router-dom\";\nimport { useEffect, useState } from \"react\";\nimport MainApi from \"../utils/MainApi\";\n\nexport default function useLogin() {\n    const [error, setError] = useState('');\n    const [token, setToken] = useState(null);\n    const [currentUser, setCurrentUser] = useState(null);\n    const navigate = useNavigate();\n\n    const login = async (email, password) => {\n        try {\n            const resp = await MainApi.login(email, password);\n            if (!resp.token) {\n                throw new Error('No token received');\n            }\n            localStorage.jwt = resp.token;\n            setToken(resp.token);\n            console.log('token', resp.token);\n        } catch (e) {\n            console.error(e);\n            setError(e.message);\n        }\n    };\n\n    useEffect(() => {\n        if (!localStorage.jwt) {\n            return;\n        }\n        MainApi.getInfo(localStorage.jwt)\n            .then((userInfo) => {\n                if (userInfo) {\n                    setCurrentUser(userInfo.data);\n                }\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n        setToken(localStorage.jwt);\n        navigate(\"/movies/all\");\n    }, []);\n\n    return {\n        currentUser,\n        login,\n        error,\n        loggedIn: !!token,\n    };\n}"],"mappings":";AAAA,SAASA,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC3C,OAAOC,OAAO,MAAM,kBAAkB;AAEtC,eAAe,SAASC,QAAQA,CAAA,EAAG;EAAAC,EAAA;EAC/B,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGL,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACM,KAAK,EAAEC,QAAQ,CAAC,GAAGP,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAACQ,WAAW,EAAEC,cAAc,CAAC,GAAGT,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAMU,QAAQ,GAAGZ,WAAW,CAAC,CAAC;EAE9B,MAAMa,KAAK,GAAG,MAAAA,CAAOC,KAAK,EAAEC,QAAQ,KAAK;IACrC,IAAI;MACA,MAAMC,IAAI,GAAG,MAAMb,OAAO,CAACU,KAAK,CAACC,KAAK,EAAEC,QAAQ,CAAC;MACjD,IAAI,CAACC,IAAI,CAACR,KAAK,EAAE;QACb,MAAM,IAAIS,KAAK,CAAC,mBAAmB,CAAC;MACxC;MACAC,YAAY,CAACC,GAAG,GAAGH,IAAI,CAACR,KAAK;MAC7BC,QAAQ,CAACO,IAAI,CAACR,KAAK,CAAC;MACpBY,OAAO,CAACC,GAAG,CAAC,OAAO,EAAEL,IAAI,CAACR,KAAK,CAAC;IACpC,CAAC,CAAC,OAAOc,CAAC,EAAE;MACRF,OAAO,CAACd,KAAK,CAACgB,CAAC,CAAC;MAChBf,QAAQ,CAACe,CAAC,CAACC,OAAO,CAAC;IACvB;EACJ,CAAC;EAEDtB,SAAS,CAAC,MAAM;IACZ,IAAI,CAACiB,YAAY,CAACC,GAAG,EAAE;MACnB;IACJ;IACAhB,OAAO,CAACqB,OAAO,CAACN,YAAY,CAACC,GAAG,CAAC,CAC5BM,IAAI,CAAEC,QAAQ,IAAK;MAChB,IAAIA,QAAQ,EAAE;QACVf,cAAc,CAACe,QAAQ,CAACC,IAAI,CAAC;MACjC;IACJ,CAAC,CAAC,CACDC,KAAK,CAAEC,GAAG,IAAK;MACZT,OAAO,CAACC,GAAG,CAACQ,GAAG,CAAC;IACpB,CAAC,CAAC;IACNpB,QAAQ,CAACS,YAAY,CAACC,GAAG,CAAC;IAC1BP,QAAQ,CAAC,aAAa,CAAC;EAC3B,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO;IACHF,WAAW;IACXG,KAAK;IACLP,KAAK;IACLwB,QAAQ,EAAE,CAAC,CAACtB;EAChB,CAAC;AACL;AAACH,EAAA,CA5CuBD,QAAQ;EAAA,QAIXJ,WAAW;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}